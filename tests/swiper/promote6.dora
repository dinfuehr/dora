//= vm-args "--gc=swiper --gc-verify"

class Foo(x: Int32)

fn main() {
    let a = Array[Int64]::fill(70i64, 0i64);
    let f1 = Foo(3i32);
    let x = CardSpanningObject::new(f1);
    std::forceMinorCollect();
    assert(x.field0 === f1);
    assert(x.field64 === f1);

    x.field0 = Foo(1i32);
    std::forceMinorCollect();
    assert(x.field0.x == 1i32);
    assert(x.field64 === f1);

    std::forceMinorCollect();
    assert(x.field0.x == 1i32);
    assert(x.field64 === f1);
}

class CardSpanningObject {
    field0: Foo,
    field1: Foo,
    field2: Foo,
    field3: Foo,
    field4: Foo,
    field5: Foo,
    field6: Foo,
    field7: Foo,
    field8: Foo,
    field9: Foo,
    field10: Foo,
    field11: Foo,
    field12: Foo,
    field13: Foo,
    field14: Foo,
    field15: Foo,
    field16: Foo,
    field17: Foo,
    field18: Foo,
    field19: Foo,
    field20: Foo,
    field21: Foo,
    field22: Foo,
    field23: Foo,
    field24: Foo,
    field25: Foo,
    field26: Foo,
    field27: Foo,
    field28: Foo,
    field29: Foo,
    field30: Foo,
    field31: Foo,
    field32: Foo,
    field33: Foo,
    field34: Foo,
    field35: Foo,
    field36: Foo,
    field37: Foo,
    field38: Foo,
    field39: Foo,
    field40: Foo,
    field41: Foo,
    field42: Foo,
    field43: Foo,
    field44: Foo,
    field45: Foo,
    field46: Foo,
    field47: Foo,
    field48: Foo,
    field49: Foo,
    field50: Foo,
    field51: Foo,
    field52: Foo,
    field53: Foo,
    field54: Foo,
    field55: Foo,
    field56: Foo,
    field57: Foo,
    field58: Foo,
    field59: Foo,
    field60: Foo,
    field61: Foo,
    field62: Foo,
    field63: Foo,
    field64: Foo,
}

impl CardSpanningObject {
    static fn new(f: Foo): CardSpanningObject {
        CardSpanningObject(
            field0 = f,
            field1 = f,
            field2 = f,
            field3 = f,
            field4 = f,
            field5 = f,
            field6 = f,
            field7 = f,
            field8 = f,
            field9 = f,
            field10 = f,
            field11 = f,
            field12 = f,
            field13 = f,
            field14 = f,
            field15 = f,
            field16 = f,
            field17 = f,
            field18 = f,
            field19 = f,
            field20 = f,
            field21 = f,
            field22 = f,
            field23 = f,
            field24 = f,
            field25 = f,
            field26 = f,
            field27 = f,
            field28 = f,
            field29 = f,
            field30 = f,
            field31 = f,
            field32 = f,
            field33 = f,
            field34 = f,
            field35 = f,
            field36 = f,
            field37 = f,
            field38 = f,
            field39 = f,
            field40 = f,
            field41 = f,
            field42 = f,
            field43 = f,
            field44 = f,
            field45 = f,
            field46 = f,
            field47 = f,
            field48 = f,
            field49 = f,
            field50 = f,
            field51 = f,
            field52 = f,
            field53 = f,
            field54 = f,
            field55 = f,
            field56 = f,
            field57 = f,
            field58 = f,
            field59 = f,
            field60 = f,
            field61 = f,
            field62 = f,
            field63 = f,
            field64 = f,
        )
    }
}